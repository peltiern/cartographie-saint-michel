<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Cartographie de Saint-Michel (16470 - France)</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--    <meta property="og:title" content="Cartographie de Saint-Michel (16470 - France)">-->
<!--    <meta property="og:description" content="Photographies aériennes de la commune de Saint-Michel (164710) : années 1922, 1948">-->
<!--    <meta property="og:image" content="https://tonsite.com/images/aperçu.jpg">-->
<!--    <meta property="og:url" content="https://peltiern.github.io/cartographie-saint-michel/">-->
<!--    <meta property="og:type" content="website">-->
<!--    <meta property="og:site_name" content="Cartographie de Saint-Michel (16470 - France)">-->
    <link rel="icon" href="img/favicon.ico"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"crossorigin=""></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
    <link rel="stylesheet" href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css'/>
</head>
<body>
<div id="map"></div>

<!-- Panneau de contrôle -->
<div class="control-panel">
    <div class="control-header" onclick="togglePanel()">
    <span class="icon-text">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25" fill="#000">
        <path d="M3.5 9.5L12 14l8.5-4.5L12 5 3.5 9.5zM12 15.5l-8.5-4.5v2l8.5 4.5 8.5-4.5v-2l-8.5 4.5zM12 19.5l-8.5-4.5v2l8.5 4.5 8.5-4.5v-2l-8.5 4.5z"/>
      </svg>
      <span>Couches</span>
    </span>
    </div>
    <div class="control-content" id="layerControl"></div>
</div>

<script>
    function togglePanel() {
        const content = document.getElementById("layerControl");
        content.style.display = content.style.display === "none" ? "block" : "none";
    }

    const map = L.map('map', {
        attributionControl: false,
        zoomControl: false
    }).setView([45.637987, 0.118228], 16);
    L.control.attribution({prefix: false}).addTo(map);
    L.control.zoom({
            zoomInTitle: 'Zoom +',
            zoomOutTitle: 'Zoom -'
        }
    ).addTo(map);
    map.addControl(new L.Control.Fullscreen({
        title: {
            'false': 'Voir en plein écran',
            'true': 'Sortir du plein écran'
        }
    }));

    // Echelle
    L.control.scale({
        metric: true,
        imperial: false,
        position: 'bottomleft'
    }).addTo(map);

    // Blason
    L.Control.Watermark = L.Control.extend({
        onAdd: function (map) {
            var img = L.DomUtil.create('img');

            img.src = './img/blason-saint-michel.svg';
            img.style.width = '50px';

            return img;
        },

        onRemove: function (map) {
            // Nothing to do here
        }
    });
    L.control.watermark = function (opts) {
        return new L.Control.Watermark(opts);
    }
    L.control.watermark({position: 'bottomleft'}).addTo(map);

    // Home
    L.Control.NavBar = L.Control.extend({
        options: {
            position: 'topleft',
            homeTitle: 'Centrer'
        },

        onAdd: function (map) {

            // Set options
            if (!this.options.center) {
                this.options.center = map.getCenter();
            }
            if (!this.options.zoom) {
                this.options.zoom = map.getZoom();
            }
            var options = this.options;

            // Create toolbar
            var controlName = 'leaflet-control-navbar',
                container = L.DomUtil.create('div', controlName + ' leaflet-bar');

            // Add toolbar buttons
            this._homeButton = this._createButton(options.homeTitle, controlName + '-home', container, this._goHome);

            // Set intial view to home
            map.setView(options.center, options.zoom);

            return container;
        },

        onRemove: function (map) {
        },

        _goHome: function () {
            if (this.options.bbox) {
                try {
                    this._map.fitBounds(this.options.bbox);
                } catch (err) {
                    this._map.setView(this.options.center, this.options.zoom); //Use default if invalid bbox input.
                }
            }
            this._map.setView(this.options.center, this.options.zoom);
        },

        _createButton: function (title, className, container, fn) {
            // Modified from Leaflet zoom control

            var link = L.DomUtil.create('a', className, container);
            link.href = '#';
            link.title = title;

            L.DomEvent
                .on(link, 'mousedown dblclick', L.DomEvent.stopPropagation)
                .on(link, 'click', L.DomEvent.stop)
                .on(link, 'click', fn, this)
                .on(link, 'click', this._refocusOnMap, this);

            return link;
        }
    });
    L.control.navbar = function (options) {
        return new L.Control.NavBar(options);
    };
    L.control.navbar().addTo(map);

    // https://igngp.geoapi.fr/tile.php
    const layers = [
        {
            name: "OpenStreetMap",
            layer: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap'
            }).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos actuelles",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/ortho/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 1,
            controlOpacity: true
        },
        {
            name: "Photos 2011-2015",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/orthos2011-2015/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos 2006-2010",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/orthos2006-2010/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos 2000-2005",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/orthos2000-2005/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos 1950-1965",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/orthos1950-1965/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos 1948",
            layer: L.tileLayer('https://github.com/peltiern/cartographie-saint-michel/raw/main/1948/{z}/{x}/{y}.png', {
                minZoom: 12,
                maxZoom: 19,
                tms: false,
                attribution: 'Créé avec <a href="https://qgis.org/" title="QGIS" target="_blank">QGIS</a> | <a href="https://github.com/peltiern/cartographie-saint-michel" title="Nicolas PELTIER" target="_blank">Nicolas PELTIER</a> | Blason par <a href="//commons.wikimedia.org/wiki/User:Celbusro" title="User:Celbusro" target="_blank">Celbusro</a> — <span class="int-own-work" lang="fr">Travail personnel</span>, <a href="https://creativecommons.org/licenses/by-sa/4.0" title="Creative Commons Attribution-Share Alike 4.0" target="_blank">CC BY-SA 4.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=35491899" target="_blank">Lien</a>'
            }).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Photos 1922",
            layer: L.tileLayer('https://github.com/peltiern/cartographie-saint-michel/raw/main/1922/{z}/{x}/{y}.png', {
                minZoom: 12,
                maxZoom: 19,
                tms: false,
                attribution: 'Créé avec <a href="https://qgis.org/" title="QGIS" target="_blank">QGIS</a> | <a href="https://github.com/peltiern/cartographie-saint-michel" title="Nicolas PELTIER" target="_blank">Nicolas PELTIER</a> | Blason par <a href="//commons.wikimedia.org/wiki/User:Celbusro" title="User:Celbusro" target="_blank">Celbusro</a> — <span class="int-own-work" lang="fr">Travail personnel</span>, <a href="https://creativecommons.org/licenses/by-sa/4.0" title="Creative Commons Attribution-Share Alike 4.0" target="_blank">CC BY-SA 4.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=35491899" target="_blank">Lien</a>'
            }).addTo(map),
            defaultOpacity: 1,
            controlOpacity: true
        },
        {
            name: "Batîments actuels",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/batiments/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Cadastre actuel",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/parcelles-cadastrales/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Routes actuelles",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/routes/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        },
        {
            name: "Limites administratives",
            layer: L.tileLayer(
                "https://igngp.geoapi.fr/tile.php/limites-administratives/{z}/{x}/{y}.png",
                {
                    minZoom: 0,
                    maxZoom: 19,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 0,
            controlOpacity: true
        }
    ];

    // Points remarquables (https://apidocs.geoapify.com/playground/icon/)
    var iconeEglise = L.icon({
        iconUrl: './img/eglise.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });
    var iconeEcolePrimaire = L.icon({
        iconUrl: './img/ecole-primaire.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });
    var iconeCentreCommercial = L.icon({
        iconUrl: './img/centre-commercial.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });
    var iconeStade = L.icon({
        iconUrl: './img/stade.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });
    var iconeCollege = L.icon({
        iconUrl: './img/college.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });
    var iconeHopital = L.icon({
        iconUrl: './img/hopital.png',
        iconSize: [37, 56],
        iconAnchor: [18, 56],
        popupAnchor: [0, -40],
    });

    var eglise = L.marker([45.6423319, 0.1056722], {icon: iconeEglise}).bindPopup('Eglise');
    var ecolePrimaire = L.marker([45.6403061, 0.1082331], {icon: iconeEcolePrimaire}).bindPopup('Ecole primaire');
    var centreCommercial = L.marker([45.6373693, 0.1117523], {icon: iconeCentreCommercial}).bindPopup('Centre commercial');
    var stade = L.marker([45.6347353, 0.1151324], {icon: iconeStade}).bindPopup('Stade');
    var college = L.marker([45.6376276, 0.1160621], {icon: iconeCollege}).bindPopup('Collège');
    var hopital = L.marker([45.6354325, 0.1199615], {icon: iconeHopital}).bindPopup('Hôpital Girac');

    var keyPoints = L.layerGroup([eglise, ecolePrimaire, centreCommercial, stade, college, hopital]);
    layers.push({
        name: "Lieux remarquables",
        layer: keyPoints,
        defaultOpacity: 0,
        controlOpacity: false
    });

    const controlContainer = document.getElementById("layerControl");

    layers.forEach(({name, layer, defaultOpacity, controlOpacity}, index) => {
        const group = document.createElement("div");
        group.className = "layer-group";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = defaultOpacity === 1;
        checkbox.id = `layer-${index}`;

        const slider = document.createElement("input");

        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.innerHTML = `<span>${name}</span>`;
        label.prepend(checkbox);
        group.appendChild(label);

        checkbox.onchange = () => {
            if (checkbox.checked) {
                if (controlOpacity) {
                    layer.setOpacity(parseFloat(slider.value));
                } else {
                    layer.addTo(map);
                }
            } else {
                if (controlOpacity) {
                    layer.setOpacity(0);
                } else {
                    map.removeLayer(layer);
                }
            }
        };

        if (controlOpacity) {
            slider.type = "range";
            slider.min = 0;
            slider.max = 1;
            slider.step = 0.01;
            slider.value = defaultOpacity;

            slider.oninput = () => {
                if (checkbox.checked) {
                    layer.setOpacity(parseFloat(slider.value));
                }
            };

            group.appendChild(slider);
        }

        // Set initial opacity si c'est une couche de type GeoJSON
        if (controlOpacity) {
            layer.setOpacity(defaultOpacity);
        }

        controlContainer.appendChild(group);
    });
</script>

</body>
</html>
