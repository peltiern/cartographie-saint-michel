<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Cartographie</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            crossorigin=""></script>
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 220px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            font-family: sans-serif;
            font-size: 13px;
            z-index: 1000;
        }

        .control-header {
            padding: 8px 12px;
            background-color: #f0f0f0;
            cursor: pointer;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
        }

        .control-content {
            padding: 8px 12px;
            display: block;
        }

        .layer-group {
            margin-bottom: 10px;
        }

        .layer-group label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .layer-group input[type="range"] {
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>

<!-- Panneau de contr√¥le -->
<div class="control-panel">
    <div class="control-header" onclick="togglePanel()">üó∫Ô∏è Couches</div>
    <div class="control-content" id="layerControl">
        <!-- Contenu g√©n√©r√© dynamiquement -->
    </div>
</div>

<script>
    function togglePanel() {
        const content = document.getElementById("layerControl");
        content.style.display = content.style.display === "none" ? "block" : "none";
    }

    const map = L.map('map', { attributionControl: false }).setView([45.641, 0.121589], 16);
    L.control.attribution({ prefix: false }).addTo(map);

    const layers = [
        {
            name: "OpenStreetMap",
            layer: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: '¬© OpenStreetMap'
            }).addTo(map),
            defaultOpacity: 1
        },
        {
            name: "IGN Orthophotos",
            layer: L.tileLayer(
                "https://data.geopf.fr/wmts?" +
                "&REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0" +
                "&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/jpeg" +
                "&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}" +
                "&TILEROW={y}&TILECOL={x}",
                {
                    minZoom: 0,
                    maxZoom: 18,
                    attribution: "IGN-F/Geoportail",
                    tileSize: 256
                }
            ).addTo(map),
            defaultOpacity: 1
        },
        {
            name: "Carte 1922",
            layer: L.tileLayer('https://github.com/peltiern/cartographie-saint-michel/raw/main/1922/{z}/{x}/{y}.png', {
                minZoom: 12,
                maxZoom: 18,
                tms: false,
                attribution: 'Cr√©√© avec QGIS | Nicolas PELTIER'
            }).addTo(map),
            defaultOpacity: 1
        }
    ];

    const controlContainer = document.getElementById("layerControl");

    layers.forEach(({ name, layer, defaultOpacity }, index) => {
        const group = document.createElement("div");
        group.className = "layer-group";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = true;
        checkbox.id = `layer-${index}`;

        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.innerHTML = `<span>${name}</span>`;
        label.prepend(checkbox);

        const slider = document.createElement("input");
        slider.type = "range";
        slider.min = 0;
        slider.max = 1;
        slider.step = 0.01;
        slider.value = defaultOpacity;

        checkbox.onchange = () => {
            if (checkbox.checked) {
                layer.setOpacity(parseFloat(slider.value));
            } else {
                layer.setOpacity(0);
            }
        };

        slider.oninput = () => {
            if (checkbox.checked) {
                layer.setOpacity(parseFloat(slider.value));
            }
        };

        // Set initial opacity
        layer.setOpacity(defaultOpacity);

        group.appendChild(label);
        group.appendChild(slider);
        controlContainer.appendChild(group);
    });
</script>
</body>
</html>
